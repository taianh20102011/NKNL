<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nhật ký — Nhật ký Năng lực</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="nav">
    <div class="container nav-inner">
      <a href="index.html" class="brand">NHẬT KÍ<span>NĂNG LỰC</span></a>
      <button id="nav-toggle" class="hamburger" aria-label="Mở menu">☰</button>
      <nav class="menu" id="nav-menu">
        <a href="index.html">Trang chủ</a>
        <a href="journal.html" class="active">Nhật ký</a>
        <a href="features.html">Tính năng</a>
        <a href="missions.html">Nhiệm vụ</a>
        <a href="profile.html">Hồ sơ</a>
        <a href="login.html" id="logout-btn">Đăng xuất</a>
      </nav>
      <button id="theme-toggle" class="theme-toggle-btn" aria-label="Chuyển chủ đề">🌙</button>
    </div>
  </header> 

  <main class="page">
    <div class="container">
      <h1>📔 Nhật ký phát triển năng lực</h1>

      <form id="journal-form" class="journal-form">
        <input type="date" id="date" required>
        <input type="text" id="goal" placeholder="🎯 Mục tiêu hôm nay" required>
        <textarea id="activities" rows="3" placeholder="💪 Hoạt động hôm nay"></textarea>
        <input type="number" id="rating" min="1" max="10" placeholder="⭐ Đánh giá (1-10)" required>
        <button type="submit" class="btn">💾 Lưu nhật ký</button>
      </form>

      <section class="chart-section">
        <h2>📊 Biểu đồ tiến bộ</h2>
        <canvas id="progressChart"></canvas>
      </section>

      <section class="log-list">
        <h2>📝 Nhật ký gần đây</h2>
        <ul id="journal-list"></ul>
      </section>
    </div>

    <section id="ai-analysis" class="ai-box">
      <h3>🧠 Phân tích AI</h3>
      <p id="ai-result">Chưa có dữ liệu để phân tích.</p>
      <button id="analyze-btn" class="btn-ai">Phân tích biểu đồ</button>
    </section>
  </main>

  <footer class="footer">© 2025 Nhật ký Năng lực</footer>

  <!-- 🔹 JS chính -->
  <script type="module" src="main.js"></script>

  <!-- 🔹 Đánh dấu hoàn thành nhiệm vụ m1 -->
  <script type="module">
    import { markMissionDone } from "./missionsTracker.js";

    const form = document.getElementById("journal-form");
    form?.addEventListener("submit", async (e) => {
      e.preventDefault();

      const text = document.getElementById("activities")?.value.trim() || "";
      if (text.length < 50) {
        alert("✍️ Hãy viết ít nhất 50 ký tự để hoàn thành nhiệm vụ nhé!");
        return;
      }

      await markMissionDone("m1");
      alert("✅ Đã hoàn thành nhiệm vụ viết nhật ký (m1)!");
    });
  </script>
</body>
</html>
