<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Lá»™ trÃ¬nh nÄƒng lá»±c â€” Nháº­t kÃ½ NÄƒng lá»±c</title>
<link rel="stylesheet" href="style.css">
<style>
  .page { padding: 40px; max-width: 1000px; margin:auto; }
  .lead { opacity: 0.8; margin-bottom: 24px; }
  .tree { display:flex; flex-wrap:wrap; justify-content:center; gap:16px; }
  .node {
    border:1px solid var(--border);
    border-radius:12px;
    padding:16px 20px;
    width:200px;
    background:var(--card);
    cursor:pointer;
    transition:all 0.25s ease;
    text-align:center;
  }
  .node:hover { background:var(--accent); color:white; transform:scale(1.05); }
  .node.locked { opacity:0.4; cursor:not-allowed; }
  .node.unlocked { box-shadow:0 0 10px rgba(79,70,229,0.3); }
  .line { width:2px; background:var(--border); height:40px; margin:auto; }
  #notify { text-align:center; margin-top:20px; font-weight:600; }
</style>
</head>
<body>
  <header class="nav">
    <div class="container nav-inner">
      <a href="index.html" class="brand">NHáº¬T KÃ<span>NÄ‚NG Lá»°C</span></a>
      <button id="nav-toggle" class="hamburger" aria-label="Má»Ÿ menu">â˜°</button>
      <div class="menu" id="nav-menu">
        <a href="index.html">Trang chá»§</a>
        <a href="journal.html">Nháº­t kÃ½</a>
        <a href="features.html">TÃ­nh nÄƒng</a>
        <a href="missions.html">Nhiá»‡m vá»¥</a>
        <a href="profile.html">Há»“ sÆ¡</a>
        <a href="growth.html" class="active">Lá»™ trÃ¬nh</a>
        <a href="login.html" id="logout-btn">ÄÄƒng xuáº¥t</a>
      </div>
      <button id="theme-toggle" class="theme-toggle-btn" aria-label="Äá»•i giao diá»‡n">ğŸŒ™</button>
    </div>
  </header>

  <main class="page">
    <h1>ğŸŒ³ Lá»™ trÃ¬nh phÃ¡t triá»ƒn nÄƒng lá»±c</h1>
    <p class="lead">KhÃ¡m phÃ¡ hÃ nh trÃ¬nh ká»¹ nÄƒng cá»§a báº¡n vÃ  má»Ÿ khÃ³a bÆ°á»›c tiáº¿p theo!</p>
    <div class="tree" id="growthTree"></div>
    <p id="notify"></p>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
    import { markMissionDone } from "./missionsTracker.js"; // liÃªn káº¿t nhiá»‡m vá»¥

    const firebaseConfig = {
      apiKey: "AIzaSyCtp4izpF1GCH2qWpeLtZOdk33A_iNKzqg",
      authDomain: "nknl-d7b54.firebaseapp.com",
      projectId: "nknl-d7b54",
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const growthTree = document.getElementById("growthTree");
    const notify = document.getElementById("notify");

    const skillPath = [
      { id: 1, title: "Báº¯t Ä‘áº§u hÃ nh trÃ¬nh ğŸŒ±", xp: 0 },
      { id: 2, title: "RÃ¨n luyá»‡n pháº£n chiáº¿u ğŸ’¬", xp: 50 },
      { id: 3, title: "PhÃ¡t triá»ƒn cáº£m xÃºc â¤ï¸", xp: 100 },
      { id: 4, title: "LÃ£nh Ä‘áº¡o báº£n thÃ¢n ğŸŒŸ", xp: 200 },
    ];

    function renderTree(xp) {
      growthTree.innerHTML = "";
      skillPath.forEach((s) => {
        const node = document.createElement("div");
        const unlocked = xp >= s.xp;
        node.className = `node ${unlocked ? "unlocked" : "locked"}`;
        node.innerHTML = `
          <div>${s.title}</div>
          <small>${unlocked ? "âœ… HoÃ n thÃ nh" : "ğŸ”’ Cáº§n " + s.xp + " XP"}</small>
        `;
        if (unlocked) {
          node.addEventListener("click", async () => {
            await markMissionDone("growth_" + s.id);
            notify.textContent = `ğŸ¯ Báº¡n vá»«a má»Ÿ khÃ³a: ${s.title}!`;
            setTimeout(() => (notify.textContent = ""), 3000);
          });
        }
        growthTree.appendChild(node);
      });
    }

    // Láº¥y XP hiá»‡n táº¡i
    onAuthStateChanged(auth, async (user) => {
      let xp = Number(localStorage.getItem("missions_xp_local") || 0);
      if (user) {
        const docRef = doc(db, "users", user.uid);
        const snap = await getDoc(docRef);
        xp = snap.exists() ? snap.data().xp || xp : xp;
      }
      renderTree(xp);
    });

    // ğŸŒ™ Giao diá»‡n sÃ¡ng/tá»‘i
    const themeToggle = document.getElementById("theme-toggle");
    let currentTheme = localStorage.getItem("theme") || "dark";
    const applyTheme = (theme) => {
      if (theme === "light") {
        document.documentElement.setAttribute("data-theme", "light");
      } else {
        document.documentElement.removeAttribute("data-theme");
      }
    };
    applyTheme(currentTheme);
    themeToggle.textContent = currentTheme === "light" ? "ğŸŒ" : "ğŸŒ™";
    themeToggle.addEventListener("click", () => {
      currentTheme = currentTheme === "light" ? "dark" : "light";
      applyTheme(currentTheme);
      localStorage.setItem("theme", currentTheme);
      themeToggle.textContent = currentTheme === "light" ? "ğŸŒ" : "ğŸŒ™";
    });

    // ğŸ“± Navbar mobile toggle
    const navToggle = document.getElementById("nav-toggle");
    const navMenu = document.getElementById("nav-menu");
    navToggle.addEventListener("click", () => {
      navMenu.classList.toggle("mobile-open");
    });
    document.addEventListener("click", (e) => {
      if (!navMenu.contains(e.target) && !navToggle.contains(e.target)) {
        navMenu.classList.remove("mobile-open");
      }
    });
    import { markMissionDone } from "./missionsTracker.js";

document.getElementById("finishLearning")?.addEventListener("click", async () => {
  const learned = Number(localStorage.getItem("words_learned") || 0);
  if (learned < 20) return alert("Báº¡n cáº§n há»c Ä‘á»§ 20 tá»« má»›i Ä‘á»ƒ hoÃ n thÃ nh nhiá»‡m vá»¥!");
  await markMissionDone("m3");
  console.log("âœ… ÄÃ£ Ä‘Ã¡nh dáº¥u hoÃ n thÃ nh nhiá»‡m vá»¥: Há»c 20 tá»« má»›i (m3)");
});

  </script>
</body>
</html>
