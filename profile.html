<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>H·ªì s∆° c√° nh√¢n ‚Äî Nh·∫≠t k√Ω nƒÉng l·ª±c</title>
<link rel="stylesheet" href="style.css">
<style>
  .profile-box { max-width:600px;margin:40px auto;padding:24px;border-radius:16px;background:var(--card);border:1px solid var(--border);text-align:center; }
  .xp-bar { height:10px;border-radius:5px;background:#ccc;overflow:hidden;margin-top:10px;}
  .xp-fill { height:10px;background:var(--accent);width:0%;transition:width 0.5s;}
  .badges { display:flex;justify-content:center;flex-wrap:wrap;margin-top:20px;gap:10px;}
  .badge { background:var(--accent);color:#fff;padding:8px 12px;border-radius:12px; }
</style>
</head>
<body>
<header class="nav">
  <div class="container nav-inner">
    <a href="index.html" class="brand">NH·∫¨T K√ç<span>NƒÇNG L·ª∞C</span></a>
    <div class="menu">
      <a href="missions.html">Nhi·ªám v·ª•</a>
      <a href="growth.html">L·ªô tr√¨nh</a>
      <a href="profile.html" class="active">H·ªì s∆°</a>
    </div>
  </div>
</header>

<section class="profile-box">
  <h1 id="profileName">Ng∆∞·ªùi d√πng</h1>
  <p>C·∫•p b·∫≠c: <b id="rankTitle">...</b></p>
  <div class="xp-bar"><div id="xpFill" class="xp-fill"></div></div>
  <p><span id="xpValue">0</span> XP</p>
  <div class="badges" id="badgeBox"></div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = { apiKey:"AIzaSyCtp4izpF1GCH2qWpeLtZOdk33A_iNKzqg", authDomain:"nknl-d7b54.firebaseapp.com", projectId:"nknl-d7b54" };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

function getRank(xp){
  if(xp>=200) return "Ng∆∞·ªùi ƒë·ªãnh h√¨nh nƒÉng l·ª±c üåü";
  if(xp>=100) return "Nh√† ph·∫£n chi·∫øu s√¢u s·∫Øc üí°";
  if(xp>=50) return "Ng∆∞·ªùi h·ªçc t√≠ch c·ª±c üí™";
  return "Ng∆∞·ªùi kh·ªüi ƒë·∫ßu üå±";
}

function renderProfile(name,xp){
  document.getElementById('profileName').textContent = name;
  document.getElementById('xpValue').textContent = xp;
  document.getElementById('rankTitle').textContent = getRank(xp);
  document.getElementById('xpFill').style.width = Math.min(xp/200*100,100)+'%';
  const badges=[];
  if(xp>=50) badges.push("üèÖ Ng∆∞·ªùi h·ªçc t√≠ch c·ª±c");
  if(xp>=100) badges.push("üéñ Nh√† ph·∫£n chi·∫øu s√¢u s·∫Øc");
  if(xp>=200) badges.push("üëë ƒê·ªãnh h√¨nh nƒÉng l·ª±c");
  document.getElementById('badgeBox').innerHTML = badges.map(b=>`<div class='badge'>${b}</div>`).join('');
}

onAuthStateChanged(auth, async user=>{
  let xp=Number(localStorage.getItem('missions_xp_local')||0);
  let name="Kh√°ch ·∫©n danh";
  if(user){
    const snap=await getDoc(doc(db,'users',user.uid));
    if(snap.exists()){ xp=snap.data().xp||xp; name=user.email||"Ng∆∞·ªùi d√πng"; }
  }
  renderProfile(name,xp);
});
  const q = (sel) => document.querySelector(sel);

document.addEventListener("DOMContentLoaded", () => {
  const themeToggle = q("#theme-toggle");
  const applyTheme = (theme) => {
    if (theme === "light") {
      document.documentElement.setAttribute("data-theme", "light");
    } else {
      document.documentElement.removeAttribute("data-theme");
    }
  };

  let currentTheme = localStorage.getItem("theme") || "dark";
  applyTheme(currentTheme);

  if (themeToggle) {
    themeToggle.textContent = currentTheme === "light" ? "üåû" : "üåô";

    themeToggle.addEventListener("click", () => {
      currentTheme = currentTheme === "light" ? "dark" : "light";
      applyTheme(currentTheme);
      localStorage.setItem("theme", currentTheme);
      themeToggle.textContent = currentTheme === "light" ? "üåû" : "üåô";
    });
  }
});
// üåü Navbar toggle for mobile
// Hamburger toggle
const navToggle = document.getElementById("nav-toggle");
const navMenu = document.getElementById("nav-menu");

if (navToggle && navMenu) {
  navToggle.addEventListener("click", () => {
    navMenu.classList.toggle("mobile-open");
  });
}

// ·∫®n menu khi click b√™n ngo√†i (tu·ª≥ ch·ªçn)
document.addEventListener("click", (e) => {
  if (!navMenu.contains(e.target) && !navToggle.contains(e.target)) {
    navMenu.classList.remove("mobile-open");
  }
});

</script>
</body>
</html>
